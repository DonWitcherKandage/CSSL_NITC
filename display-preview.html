<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NITC 2025 Conference Display - Preview Mode</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.10/hls.min.js"></script>
    <style>
        /* Override for single screen display */
        .container { 
            display: block; 
        }
        .screen-2 { 
            display: none !important; 
        }
        .screen-1 { 
            width: 100vw; 
            height: 100vh; 
            flex: none;
        }

        /* Preview mode highlight styles - reduced glow and better spacing */
        .preview-highlight {
            background: white !important;
            color: #081A30 !important;
            padding: 30px !important;
            border-radius: 15px !important;
            transform: none !important;
            box-shadow: 0 4px 20px rgba(255, 255, 255, 0.3) !important;
            border: 2px solid #3498db !important;
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
            z-index: 100 !important;
            position: relative !important;
            margin: 10px 0 30px 0 !important;
        }

        .preview-highlight .time {
            color: #081A30 !important;
            font-weight: bold !important;
        }

        .preview-highlight .title {
            color: #081A30 !important;
            font-weight: 600 !important;
        }

        /* Preview mode indicator */
        .preview-indicator {
            position: absolute;
            top: 80px;
            right: 20px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 15px 25px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 1.1em;
            box-shadow: 0 4px 15px rgba(44, 62, 80, 0.3);
            z-index: 1002;
            animation: previewPulse 2s infinite;
        }

        @keyframes previewPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }
    </style>
</head>
<body>
    <!-- Live indicator showing system is running -->
    <div class="status-indicator">● PREVIEW</div>
    
    <!-- Current time clock -->
    <div class="clock" id="currentClock">00:00:00</div>

    <!-- Main container holding screen 1 only -->
    <div class="container">
        <!-- Screen 1: Agenda List (Full Screen) with Particles -->
        <div id="screen1" class="screen screen-1">
            <div id="tsparticles-left"></div>
            <div id="agendaList" class="agenda-list"></div>
        </div>
    </div>

    <!-- Control buttons - hidden for preview mode -->
    <div id="controls" class="controls" style="display: none;">
        <button id="prevBtn" class="btn">← Previous</button>
        <button id="nextBtn" class="btn">Next →</button>
        <button id="autoBtn" class="btn">Auto Mode</button>
    </div>

    <!-- Debug panel -->
    <div id="debugPanel" class="debug-panel">
        <div>System Time: <span id="debugSystemTime"></span></div>
        <div>Display Time: <span id="debugDisplayTime"></span></div>
        <div>Current Event: <span id="debugCurrentEvent"></span></div>
        <div>Mode: <span id="debugMode">Preview</span></div>
        <div>Status: <span id="debugStatus">Preview Active</span></div>
        <div>Day: <span id="debugDay">Inauguration</span></div>
        <div id="particleError" style="color: #e74c3c; display: none; margin-top: 5px;">
            Particle initialization failed. Check console for details.
        </div>
    </div>

    <!-- tsParticles Core Library -->
    <script src="https://unpkg.com/tsparticles@2.12.0/tsparticles.bundle.min.js"></script>
    
    <!-- Conference System Scripts -->
    <script src="model.js"></script>
    <script src="view.js"></script>
    <script src="controller.js"></script>
    
    <!-- Preview Mode Script - Pure Sequential Highlighting -->
    <script>
/* ============================================================================
   PREVIEW MODE APPLICATION - PURE SEQUENTIAL HIGHLIGHTING OF ALL AGENDA ITEMS
   ============================================================================ */

// Global controller instance
let conferenceApp = null;

// Preview mode variables
let previewInterval = null;
let currentHighlightIndex = 0;
let highlightDuration = 12000; // 12 seconds

/**
 * Initialize particles for display 1 only
 */
async function initializeParticles() {
    try {
        if (typeof tsParticles === 'undefined') {
            throw new Error('tsParticles library not loaded');
        }

        const slowMotionConfig = {
            particles: {
                color: {
                    value: "#ffffff"
                },
                links: {
                    color: "#ffffff",
                    opacity: 0.3,
                    width: 1,
                    distance: 120
                },
                number: {
                    value: 50
                },
                opacity: {
                    value: 0.4,
                    random: {
                        enable: true,
                        minimumValue: 0.1
                    }
                },
                size: {
                    value: 2,
                    random: {
                        enable: true,
                        minimumValue: 1
                    }
                },
                move: {
                    enable: true,
                    speed: 0.2,
                    direction: "none",
                    random: true,
                    straight: false,
                    outModes: {
                        default: "bounce"
                    }
                }
            },
            background: {
                color: {
                    value: "transparent"
                }
            },
            interactivity: {
                events: {
                    onHover: {
                        enable: true,
                        mode: "grab"
                    },
                    onClick: {
                        enable: false
                    }
                },
                modes: {
                    grab: {
                        distance: 100,
                        links: {
                            opacity: 0.6
                        }
                    }
                }
            },
            detectRetina: true,
            fpsLimit: 30
        };

        await tsParticles.load("tsparticles-left", slowMotionConfig);
        
        console.log('Particles initialized successfully for Preview Mode');
        
        const particleError = document.getElementById('particleError');
        if (particleError) {
            particleError.style.display = 'none';
        }
        
    } catch (error) {
        console.error('Failed to initialize particles:', error.message);
        
        const particleError = document.getElementById('particleError');
        if (particleError) {
            particleError.style.display = 'block';
            particleError.textContent = `Particles failed: ${error.message}`;
        }
        
        setTimeout(() => {
            console.log('Retrying particle initialization...');
            initializeParticles();
        }, 5000);
    }
}

/**
 * Force all events to render as a simple list (ignore current/upcoming logic)
 */
function forceAllEventsAsSimpleList() {
    if (!conferenceApp || !conferenceApp.model) return;
    
    const agenda = conferenceApp.model.getAgendaData();
    const agendaContainer = document.getElementById('agendaList');
    
    if (!agendaContainer || agenda.length === 0) return;
    
    // Clear existing content
    agendaContainer.innerHTML = '';
    
    // Create header section
    const headerSection = document.createElement('div');
    headerSection.className = 'agenda-header';
    headerSection.innerHTML = `
        <div class="conference-logo">
            <img src="nitc-logo.png" alt="NITC 2025 Logo">
        </div>
        <div class="event-title-section">
            <div class="event-title">EVENT<br>SCHEDULE</div>
            <div class="event-day">${conferenceApp.view.currentDay}</div>
        </div>
    `;
    agendaContainer.appendChild(headerSection);
    
    // Create upcoming events section with ALL agenda items
    const upcomingSection = document.createElement('div');
    upcomingSection.className = 'upcoming-events';
    
    // Add ALL agenda items as upcoming events (no current event card)
    agenda.forEach((item, index) => {
        const eventElement = document.createElement('div');
        eventElement.className = 'upcoming-event';
        eventElement.innerHTML = `
            <div class="time">${item.displayTime}</div>
            <div class="title">${item.title}</div>
        `;
        upcomingSection.appendChild(eventElement);
    });
    
    agendaContainer.appendChild(upcomingSection);
    
    console.log(`Rendered ${agenda.length} events as simple list for preview`);
}

/**
 * Start preview highlighting
 */
function startPreviewHighlighting() {
    console.log('Starting preview highlighting mode - pure sequential');
    
    // Force simple list rendering first
    forceAllEventsAsSimpleList();
    
    // Start highlighting immediately
    doHighlight();
    
    // Continue every 12 seconds
    previewInterval = setInterval(doHighlight, highlightDuration);
}

/**
 * Perform the highlighting - PURE SEQUENTIAL ON ALL AGENDA ITEMS
 */
function doHighlight() {
    if (!conferenceApp || !conferenceApp.model) return;
    
    const agenda = conferenceApp.model.getAgendaData();
    if (agenda.length === 0) return;
    
    // Ensure we have the simple list rendered
    forceAllEventsAsSimpleList();
    
    // Clear all previous highlights
    const allEvents = document.querySelectorAll('.upcoming-event');
    allEvents.forEach(element => {
        element.classList.remove('preview-highlight');
    });
    
    // Highlight the current index directly
    if (allEvents[currentHighlightIndex]) {
        allEvents[currentHighlightIndex].classList.add('preview-highlight');
        
        const targetItem = agenda[currentHighlightIndex];
        console.log(`Highlighting ${currentHighlightIndex + 1}/${agenda.length}: ${targetItem.displayTime} - ${targetItem.title}`);
    }
    
    // Move to next event
    currentHighlightIndex = (currentHighlightIndex + 1) % agenda.length;
}

/**
 * Initialize the application when page loads
 */
function initializeConferenceApp() {
    try {
        console.log('NITC 2025 Conference Preview Mode Starting...');
        console.log('================================================');
        
        // Create the controller (which creates model and view)
        conferenceApp = new ConferenceController();
        
        // Set up cross-display synchronization
        setupCrossDisplaySync();
        
        // Initialize particles after a short delay to ensure DOM is ready
        setTimeout(() => {
            initializeParticles();
        }, 1000);
        
        // Start preview highlighting after everything is loaded
        setTimeout(() => {
            startPreviewHighlighting();
        }, 3000);
        
        // Log system information
        console.log('Location: Sri Lanka (UTC+5:30)');
        console.log('Schedule: 12:00 PM - 6:00 PM');
        console.log('Mode: Preview Mode with Pure Sequential Highlighting');
        console.log('Design: NITC 2025 Conference Theme with Slow-Motion Particles');
        console.log('Display: Preview - All Agenda Items Sequential');
        console.log('================================================');
        
        // Log available controls
        setTimeout(() => {
            logAvailableControls();
        }, 3000);
        
    } catch (error) {
        console.error('Critical error initializing conference app:', error);
        
        // Show error in the UI if possible
        const errorContainer = document.getElementById('agendaList');
        if (errorContainer) {
            errorContainer.innerHTML = `
                <div style="color: white; text-align: center; padding: 50px;">
                    <h2>System Error</h2>
                    <p>Failed to initialize NITC 2025 conference display system</p>
                    <div style="margin-top: 20px;">
                        <h4>Error Details</h4>
                        <p>Please refresh the page</p>
                        <p>Check your internet connection</p>
                        <p>Contact technical support</p>
                        <p style="font-family: monospace; font-size: 0.8em; margin-top: 10px;">
                            Error: ${error.message}
                        </p>
                    </div>
                </div>
            `;
        }
    }
}

/**
 * Set up cross-display synchronization
 */
function setupCrossDisplaySync() {
    setInterval(() => {
        if (conferenceApp) {
            const status = conferenceApp.getSystemStatus();
            localStorage.setItem('nitc2025_sync', JSON.stringify({
                currentEventIndex: -1, // Override - no current event in preview
                conferenceStatus: 'preview',
                currentTime: status.currentTime,
                timestamp: Date.now()
            }));
        }
    }, 1000);
}

/**
 * Log available control functions to console
 */
function logAvailableControls() {
    console.log('\nAvailable Console Commands:');
    console.log('=====================================');
    console.log('hideButtons()         - Hide control buttons for production');
    console.log('showButtons()         - Show control buttons for testing');
    console.log('getStatus()           - Get current system status');
    console.log('getSchedule()         - View full conference schedule');
    console.log('restartSystem()       - Restart the entire system');
    console.log('setDay("Day 1")       - Change conference day display');
    console.log('hideParticles()       - Hide particle effects');
    console.log('showParticles()       - Show particle effects');
    console.log('stopPreview()         - Stop preview highlighting');
    console.log('startPreview()        - Start preview highlighting');
    console.log('');
    console.log('System Information:');
    console.log('- Pure sequential highlighting of ALL agenda items');
    console.log('- Ignores real-time current/upcoming logic');
    console.log('- Each event highlighted for 12 seconds');
    console.log('- Continuous loop through entire agenda');
    console.log('=====================================\n');
}

/**
 * Hide control buttons (for production deployment)
 */
function hideButtons() {
    if (conferenceApp) {
        conferenceApp.hideControlButtons();
        
        const debugPanel = document.getElementById('debugPanel');
        if (debugPanel) {
            debugPanel.style.display = 'none';
        }
        
        console.log('Production mode activated - controls hidden');
    } else {
        console.log('System not ready yet. Please wait for initialization.');
    }
}

/**
 * Show control buttons (for testing)
 */
function showButtons() {
    if (conferenceApp) {
        conferenceApp.showControlButtons();
        
        const debugPanel = document.getElementById('debugPanel');
        if (debugPanel) {
            debugPanel.style.display = 'block';
        }
        
        console.log('Testing mode activated - controls visible');
    } else {
        console.log('System not ready yet. Please wait for initialization.');
    }
}

/**
 * Hide particle effects
 */
function hideParticles() {
    const leftParticles = document.getElementById('tsparticles-left');
    if (leftParticles) leftParticles.style.display = 'none';
    console.log('Particles hidden');
}

/**
 * Show particle effects
 */
function showParticles() {
    const leftParticles = document.getElementById('tsparticles-left');
    if (leftParticles) leftParticles.style.display = 'block';
    console.log('Particles shown');
}

/**
 * Stop preview highlighting
 */
function stopPreview() {
    if (previewInterval) {
        clearInterval(previewInterval);
        previewInterval = null;
    }
    
    // Clear all highlights
    const allEvents = document.querySelectorAll('.upcoming-event');
    allEvents.forEach(element => {
        element.classList.remove('preview-highlight');
    });
    
    console.log('Preview highlighting stopped');
}

/**
 * Start preview highlighting
 */
function startPreview() {
    stopPreview(); // Clear any existing interval
    startPreviewHighlighting();
    console.log('Preview highlighting started');
}

/**
 * Get current system status
 */
function getStatus() {
    if (conferenceApp) {
        const status = conferenceApp.getSystemStatus();
        console.log('NITC 2025 Conference System Status - Preview Mode:');
        console.log('====================================');
        console.log(`Current Time: ${status.currentTime} (Sri Lankan)`);
        console.log(`Conference Status: Preview Mode`);
        console.log(`Preview Active: ${previewInterval ? 'Yes' : 'No'}`);
        console.log(`Current Highlight Index: ${currentHighlightIndex}`);
        console.log('====================================');
        return status;
    } else {
        console.log('System not ready yet. Please wait for initialization.');
        return null;
    }
}

/**
 * Restart the entire system
 */
function restartSystem() {
    if (conferenceApp) {
        console.log('Restarting NITC 2025 conference system...');
        stopPreview();
        conferenceApp.restart();
        
        setTimeout(() => {
            initializeParticles();
            startPreviewHighlighting();
        }, 2000);
        
        console.log('System restarted successfully with preview mode');
    } else {
        console.log('Starting system for the first time...');
        initializeConferenceApp();
    }
}

/**
 * Get conference schedule for reference
 */
function getSchedule() {
    if (conferenceApp) {
        const agenda = conferenceApp.model.getAgendaData();
        console.log('NITC 2025 Conference Schedule (Sri Lankan Time):');
        console.log('=================================================');
        agenda.forEach((item, index) => {
            console.log(`${index + 1}. ${item.displayTime} - ${item.title} (${item.duration} min)`);
        });
        console.log('=================================================');
        return agenda;
    } else {
        console.log('System not ready yet. Please wait for initialization.');
        return null;
    }
}

/**
 * Change conference day display
 */
function setDay(dayName) {
    if (conferenceApp) {
        conferenceApp.view.updateConferenceDay(dayName);
        console.log(`Conference day updated to: ${dayName}`);
        
        // Restart preview with new day
        setTimeout(() => {
            startPreviewHighlighting();
        }, 500);
    } else {
        console.log('System not ready yet. Please wait for initialization.');
    }
}

// Initialize when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeConferenceApp);
} else {
    initializeConferenceApp();
}

// Handle page errors
window.addEventListener('error', (event) => {
    console.error('Unhandled error:', event.error);
});

// Expose global functions
window.hideButtons = hideButtons;
window.showButtons = showButtons;
window.getStatus = getStatus;
window.getSchedule = getSchedule;
window.restartSystem = restartSystem;
window.setDay = setDay;
window.hideParticles = hideParticles;
window.showParticles = showParticles;
window.stopPreview = stopPreview;
window.startPreview = startPreview;

// Expose the controller for advanced debugging
Object.defineProperty(window, 'conferenceApp', {
    get: () => conferenceApp,
    enumerable: true
});

// Monitor system health
setInterval(() => {
    if (conferenceApp) {
        const status = conferenceApp.getSystemStatus();
        if (!status.isRunning) {
            console.warn('System health check: Updates not running, attempting restart...');
            conferenceApp.restart();
        }
    }
}, 30000);

// Log system startup completion
setTimeout(() => {
    if (conferenceApp) {
        console.log('NITC 2025 Conference Preview Display is ready!');
        console.log('Pure sequential highlighting active - ALL agenda items');
        console.log('No current event distinction - just agenda[0], agenda[1], agenda[2]...');
        console.log('Type stopPreview() to stop highlighting');
        console.log('Type setDay("Day 1") to change day and restart preview');
    }
}, 5000);
    </script>
</body>
</html>