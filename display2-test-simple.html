<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NITC 2025 Conference Display - Screen 2 (Test Mode - Simple)</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Additional styles for the test page */
        .test-info {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
        }
        .camera-debug {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
            max-width: 300px;
        }
        
        /* Ensure proper center alignment for conference content */
        .conference-content {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .conference-content .current-time {
            text-align: center;
        }
        
        .conference-content .current-title {
            text-align: center;
        }
        
        .conference-content .current-description {
            text-align: center;
            max-width: 80%;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        /* Ensure webcam container is properly centered */
        .webcam-container {
            margin: 0 auto;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="test-info">
        <strong>TEST MODE</strong><br>
        Laptop Camera Test
    </div>
    
    <div class="status-indicator">‚óè LIVE - TEST MODE</div>
    <div class="clock" id="currentClock">00:00:00</div>

    <div class="container">
        <div id="screen2" class="screen screen-2">
            <div id="tsparticles-right"></div>
            <div id="currentDetail" class="current-detail">
                
                <!-- Conference Content Section -->
                <div class="conference-content">
                    <div class="current-time">12:00 PM</div>
                    <div class="current-title">Education Technology</div>
                    <div class="current-description" style="text-align: center; max-width: 80%; margin: 0 auto;">EdTech platforms and digital learning innovations.</div>
                </div>

                <!-- Camera Container for Laptop Camera -->
                <div class="webcam-container">
                    <div class="webcam-header">
                        <div class="webcam-title">Live From Laptop Camera (Test)</div>
                        <div class="webcam-status" id="streamStatus">‚óè CONNECTING</div>
                    </div>
                    
                    <!-- Loading message before stream starts -->
                    <div class="webcam-loading" id="loadingMessage">
                        <div class="loading-spinner"></div>
                        <h3>Preparing Camera Feed</h3>
                        <p>Requesting laptop camera access...</p>
                    </div>
                    
                    <!-- Video element for camera stream -->
                    <video
                        id="cameraVideo"
                        class="webcam-feed"
                        style="display: none;"
                        muted
                        autoplay
                        playsinline>
                    </video>
                    
                    <!-- Manual start button (always visible) -->
                    <div id="manualStart" style="display: none; text-align: center; padding: 20px;">
                        <button onclick="requestCameraAccess()" style="padding: 15px 30px; background: #3498db; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold;">
                            üìπ Start Camera
                        </button>
                        <p style="margin-top: 10px; color: #bdc3c7; font-size: 14px;">Click to start your laptop camera</p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="camera-debug" id="debugInfo">
        <strong>Camera Debug Info:</strong><br>
        <span id="debugStatus">Initializing...</span><br>
        <span id="debugError"></span>
    </div>

    <script>
    // Simple camera implementation without conflicts
    const video = document.getElementById('cameraVideo');
    const loadingMessage = document.getElementById('loadingMessage');
    const streamStatus = document.getElementById('streamStatus');
    const debugStatus = document.getElementById('debugStatus');
    const debugError = document.getElementById('debugError');
    let currentStream = null;

    function updateDebug(message, isError = false) {
        debugStatus.textContent = message;
        if (isError) {
            debugError.textContent = message;
            debugError.style.color = '#ff6b6b';
        } else {
            debugError.textContent = '';
        }
        console.log('Debug:', message);
    }

    function updateStatus(message, isError = false) {
        console.log('Status:', message);
        if (isError) {
            streamStatus.textContent = '‚óè OFFLINE';
            streamStatus.style.color = '#ff0000';
        } else {
            streamStatus.textContent = '‚óè LIVE';
            streamStatus.style.color = '#00ff00';
        }
    }

    function showError(message) {
        loadingMessage.innerHTML = 
            '<div style="text-align: center;">' +
            '<h3>Camera Access Required</h3>' +
            '<p>' + message + '</p>' +
            '<button onclick="requestCameraAccess()" style="margin-top: 15px; padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">Allow Camera Access</button>' +
            '</div>';
        loadingMessage.style.display = 'flex';
        document.getElementById('manualStart').style.display = 'block';
        updateStatus('Camera access needed', true);
        updateDebug(message, true);
    }

    function requestCameraAccess() {
        updateDebug('Requesting camera access...');
        loadingMessage.innerHTML = 
            '<div class="loading-spinner"></div>' +
            '<h3>Requesting Camera Access</h3>' +
            '<p>Please allow camera access when prompted...</p>';
        loadingMessage.style.display = 'flex';
        document.getElementById('manualStart').style.display = 'none';
        
        // Check if getUserMedia is supported
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            showError('Camera access is not supported in this browser. Please use Chrome, Firefox, or Safari.');
            return;
        }

        updateDebug('Checking camera permissions...');
        navigator.mediaDevices.getUserMedia({ 
            video: { 
                width: { ideal: 1280 },
                height: { ideal: 720 },
                facingMode: 'user'
            }, 
            audio: false 
        })
        .then(stream => {
            updateDebug('Camera access granted!');
            currentStream = stream;
            video.srcObject = stream;
            
            video.onloadedmetadata = function() {
                updateDebug(`Video metadata loaded: ${video.videoWidth}x${video.videoHeight}`);
                video.play().then(() => {
                    updateDebug('Camera stream playing successfully');
                    loadingMessage.style.display = 'none';
                    document.getElementById('manualStart').style.display = 'none';
                    video.style.display = 'block';
                    updateStatus('Camera connected', false);
                }).catch(err => {
                    console.error('Play error:', err);
                    updateDebug('Failed to start camera playback', true);
                    showError('Failed to start camera playback. Please try again.');
                });
            };
            
            video.oncanplay = function() {
                updateDebug('Video can play, attempting to show...');
                if (video.paused) {
                    video.play().then(() => {
                        updateDebug('Camera stream started on canplay event');
                        loadingMessage.style.display = 'none';
                        document.getElementById('manualStart').style.display = 'none';
                        video.style.display = 'block';
                        updateStatus('Camera connected', false);
                    });
                }
            };
            
            video.onerror = function(err) {
                console.error('Video error:', err);
                updateDebug('Camera stream error', true);
                showError('Camera stream error. Please try again.');
            };
        })
        .catch(err => {
            console.error('Camera access error:', err);
            updateDebug(`Camera error: ${err.name}`, true);
            
            let errorMessage = 'Camera access denied or not available';
            if (err.name === 'NotAllowedError') {
                errorMessage = 'Camera access was denied. Please click "Allow" when prompted by your browser, or check your browser settings to allow camera access for this site.';
            } else if (err.name === 'NotFoundError') {
                errorMessage = 'No camera found on this device. Please connect a camera and try again.';
            } else if (err.name === 'NotReadableError') {
                errorMessage = 'Camera is already in use by another application. Please close other applications using the camera and try again.';
            } else if (err.name === 'OverconstrainedError') {
                errorMessage = 'Camera settings are not supported. Trying with default settings...';
                updateDebug('Trying with basic camera settings...');
                // Try with more basic constraints
                navigator.mediaDevices.getUserMedia({ video: true, audio: false })
                .then(stream => {
                    currentStream = stream;
                    video.srcObject = stream;
                    video.play().then(() => {
                        loadingMessage.style.display = 'none';
                        document.getElementById('manualStart').style.display = 'none';
                        video.style.display = 'block';
                        updateStatus('Camera connected', false);
                        updateDebug('Camera connected with basic settings');
                    });
                })
                .catch(() => {
                    showError('Camera access failed with all settings. Please check your camera.');
                });
                return;
            }
            
            showError(errorMessage);
        });
    }

    // Check if we already have camera permission
    async function checkExistingPermission() {
        try {
            if (navigator.permissions) {
                const permission = await navigator.permissions.query({ name: 'camera' });
                updateDebug(`Camera permission status: ${permission.state}`);
                if (permission.state === 'granted') {
                    updateDebug('Camera permission already granted, requesting stream...');
                    return true;
                }
            }
        } catch (err) {
            updateDebug('Permission API not available');
        }
        return false;
    }

    // Initialize camera when page loads
    document.addEventListener('DOMContentLoaded', async function() {
        updateDebug('Test page loaded, checking camera availability...');
        
        // Check if we're on HTTPS or localhost
        if (location.protocol !== 'https:' && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
            showError('Camera access requires HTTPS or localhost. Please open this file from a local server or use HTTPS.');
            return;
        }
        
        // Check if we already have permission
        const hasPermission = await checkExistingPermission();
        if (hasPermission) {
            updateDebug('Already have permission, requesting stream immediately...');
            requestCameraAccess();
        } else {
            updateDebug('No existing permission, will request...');
            setTimeout(requestCameraAccess, 1000);
        }
    });

    // Stop camera when page is hidden to save resources
    document.addEventListener('visibilitychange', function() {
        if (document.hidden && currentStream) {
            currentStream.getTracks().forEach(track => track.stop());
            updateDebug('Camera stopped (page hidden)');
            currentStream = null;
        } else if (!document.hidden && !currentStream) {
            setTimeout(requestCameraAccess, 500);
        }
    });

    // Cleanup on page unload
    window.addEventListener('beforeunload', function() {
        if (currentStream) {
            currentStream.getTracks().forEach(track => track.stop());
            currentStream = null;
        }
    });

    // Make requestCameraAccess globally available for the button
    window.requestCameraAccess = requestCameraAccess;

    // Update clock
    function updateClock() {
        const now = new Date();
        const timeString = now.toLocaleTimeString();
        document.getElementById('currentClock').textContent = timeString;
    }
    
    setInterval(updateClock, 1000);
    updateClock();
    </script>
</body>
</html>
